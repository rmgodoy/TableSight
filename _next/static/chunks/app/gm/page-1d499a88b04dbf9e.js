(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[119],{285:(e,t,a)=>{"use strict";a.d(t,{$:()=>d,r:()=>o});var s=a(5155),l=a(2115),r=a(4253),n=a(2085),i=a(9434);let o=(0,n.F)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),d=l.forwardRef((e,t)=>{let{className:a,variant:l,size:n,asChild:d=!1,...c}=e,u=d?r.DX:"button";return(0,s.jsx)(u,{className:(0,i.cn)(o({variant:l,size:n,className:a})),ref:t,...c})});d.displayName="Button"},1092:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>eL});var s=a(5155),l=a(2115),r=a(285),n=a(6695),i=a(9471),o=a(7607),d=a(4607),c=a(3152),u=a(5222),h=a(4956),m=a(2354),f=a(7481),p=a(7489),x=a(9434);let g=l.forwardRef((e,t)=>{let{className:a,orientation:l="horizontal",decorative:r=!0,...n}=e;return(0,s.jsx)(p.b,{ref:t,decorative:r,orientation:l,className:(0,x.cn)("shrink-0 bg-border","horizontal"===l?"h-[1px] w-full":"h-full w-[1px]",a),...n})});g.displayName=p.b.displayName;var b=a(4809),j=a(366),v=a(8061),y=a(154),N=a(7724),w=a(7326),k=a(335),C=a(5731),S=a(2728),z=a(4982),A=a(799),T=a(848),E=a(3884),P=a(6923),I=a(8082);let R=I.Kq,L=I.bL,D=I.l9,O=l.forwardRef((e,t)=>{let{className:a,sideOffset:l=4,...r}=e;return(0,s.jsx)(I.UC,{ref:t,sideOffset:l,className:(0,x.cn)("z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",a),...r})});function _(e){let{selectedTool:t,onToolSelect:a,onImport:n,undo:i,redo:o,resetView:d,zoomIn:c,zoomOut:u}=e,h=(0,l.useRef)(null),m=[{id:"select",label:"Select",icon:(0,s.jsx)(b.A,{})},{id:"draw",label:"Draw",icon:(0,s.jsx)(j.A,{})},{id:"rectangle",label:"Rectangle",icon:(0,s.jsx)(v.A,{})},{id:"circle",label:"Circle",icon:(0,s.jsx)(y.A,{})},{id:"portal",label:"Portal",icon:(0,s.jsx)(N.A,{})},{id:"erase",label:"Erase",icon:(0,s.jsx)(w.A,{})},{id:"add-pc",label:"Add PC",icon:(0,s.jsx)(k.A,{})},{id:"add-enemy",label:"Add Enemy",icon:(0,s.jsx)(C.A,{})}],f=[{id:"undo",label:"Undo",icon:(0,s.jsx)(S.A,{}),action:i},{id:"redo",label:"Redo",icon:(0,s.jsx)(z.A,{}),action:o},{id:"zoom-in",label:"Zoom In",icon:(0,s.jsx)(A.A,{}),action:c},{id:"zoom-out",label:"Zoom Out",icon:(0,s.jsx)(T.A,{}),action:u},{id:"reset-view",label:"Reset View",icon:(0,s.jsx)(E.A,{}),action:d}];return(0,s.jsx)(R,{delayDuration:100,children:(0,s.jsxs)("aside",{className:"w-16 h-full flex flex-col items-center p-2 gap-2 border-r border-border bg-card z-20",children:[(0,s.jsx)("h1",{className:"text-2xl font-bold font-headline text-primary pb-2",children:"TA"}),(0,s.jsx)(g,{}),(0,s.jsx)("div",{className:"flex flex-col gap-2",children:m.map(e=>(0,s.jsxs)(L,{children:[(0,s.jsx)(D,{asChild:!0,children:(0,s.jsx)(r.$,{size:"icon",variant:t===e.id?"default":"ghost",className:"w-10 h-10",onClick:()=>a(e.id),children:e.icon})}),(0,s.jsx)(O,{side:"right",children:(0,s.jsx)("p",{children:e.label})})]},e.id))}),(0,s.jsx)(g,{}),(0,s.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,s.jsxs)(L,{children:[(0,s.jsx)(D,{asChild:!0,children:(0,s.jsx)(r.$,{size:"icon",variant:"ghost",className:"w-10 h-10",onClick:()=>{var e;null==(e=h.current)||e.click()},children:(0,s.jsx)(P.A,{})})}),(0,s.jsx)(O,{side:"right",children:(0,s.jsx)("p",{children:"Import .dd2vtt Map"})})]}),(0,s.jsx)("input",{type:"file",ref:h,className:"hidden",accept:".dd2vtt",onChange:e=>{var t;let a=null==(t=e.target.files)?void 0:t[0];a&&n(a),e.target.value=""}})]}),(0,s.jsx)(g,{}),(0,s.jsx)("div",{className:"flex flex-col gap-2",children:f.map(e=>(0,s.jsxs)(L,{children:[(0,s.jsx)(D,{asChild:!0,children:(0,s.jsx)(r.$,{size:"icon",variant:"ghost",className:"w-10 h-10",onClick:e.action,children:e.icon})}),(0,s.jsx)(O,{side:"right",children:(0,s.jsx)("p",{children:e.label})})]},e.id))})]})})}O.displayName=I.UC.displayName;var M=a(7569),F=a(3153),U=a(7223),V=a(8553),$=a(6438),Z=a(8046),B=a(5599),W=a(286),J=a(8186),H=a(2523),K=a(8176);let Y=K.bL,q=K.l9,G=l.forwardRef((e,t)=>{let{className:a,align:l="center",sideOffset:r=4,...n}=e;return(0,s.jsx)(K.ZL,{children:(0,s.jsx)(K.UC,{ref:t,align:l,sideOffset:r,className:(0,x.cn)("z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",a),...n})})});G.displayName=K.UC.displayName;var X=a(1893);let Q=X.bL,ee=X.l9,et=X.ZL,ea=l.forwardRef((e,t)=>{let{className:a,...l}=e;return(0,s.jsx)(X.hJ,{className:(0,x.cn)("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",a),...l,ref:t})});ea.displayName=X.hJ.displayName;let es=l.forwardRef((e,t)=>{let{className:a,...l}=e;return(0,s.jsxs)(et,{children:[(0,s.jsx)(ea,{}),(0,s.jsx)(X.UC,{ref:t,className:(0,x.cn)("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",a),...l})]})});es.displayName=X.UC.displayName;let el=e=>{let{className:t,...a}=e;return(0,s.jsx)("div",{className:(0,x.cn)("flex flex-col space-y-2 text-center sm:text-left",t),...a})};el.displayName="AlertDialogHeader";let er=e=>{let{className:t,...a}=e;return(0,s.jsx)("div",{className:(0,x.cn)("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",t),...a})};er.displayName="AlertDialogFooter";let en=l.forwardRef((e,t)=>{let{className:a,...l}=e;return(0,s.jsx)(X.hE,{ref:t,className:(0,x.cn)("text-lg font-semibold",a),...l})});en.displayName=X.hE.displayName;let ei=l.forwardRef((e,t)=>{let{className:a,...l}=e;return(0,s.jsx)(X.VY,{ref:t,className:(0,x.cn)("text-sm text-muted-foreground",a),...l})});ei.displayName=X.VY.displayName;let eo=l.forwardRef((e,t)=>{let{className:a,...l}=e;return(0,s.jsx)(X.rc,{ref:t,className:(0,x.cn)((0,r.r)(),a),...l})});eo.displayName=X.rc.displayName;let ed=l.forwardRef((e,t)=>{let{className:a,...l}=e;return(0,s.jsx)(X.ZD,{ref:t,className:(0,x.cn)((0,r.r)({variant:"outline"}),"mt-2 sm:mt-0",a),...l})});ed.displayName=X.ZD.displayName;var ec=a(6874),eu=a.n(ec),eh=a(968),em=a(2085);let ef=(0,em.F)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),ep=l.forwardRef((e,t)=>{let{className:a,...l}=e;return(0,s.jsx)(eh.b,{ref:t,className:(0,x.cn)(ef(),a),...l})});function ex(e){let{tokens:t,onVisibilityChange:a,onTokenDelete:i,onTokenNameChange:c,onTokenColorChange:u,onTokenIconChange:h,onTokenSizeChange:m,onTokenTorchToggle:p,onTokenTorchRadiusChange:b,sessionId:j,syncPlayerView:v,matchPlayerView:y}=e,{toast:N}=(0,f.dj)(),[w,S]=(0,l.useState)("");(0,l.useEffect)(()=>{S("".concat(window.location.origin,"/player#").concat(j))},[j]);let z=(e,t)=>{var a;let s=null==(a=t.target.files)?void 0:a[0];if(s){let t=new FileReader;t.onload=t=>{var a;(null==(a=t.target)?void 0:a.result)&&h(e,t.target.result)},t.readAsDataURL(s)}},A=e=>"PC"===e.type?(0,s.jsx)(k.A,{className:"text-white/80"}):"Enemy"===e.type?(0,s.jsx)(C.A,{className:"text-white/80"}):"Light"===e.type?(0,s.jsx)(M.A,{className:(0,x.cn)("text-white/80",e.torch.enabled&&"text-yellow-300")}):"Portal"===e.type?(0,s.jsx)(F.A,{className:"text-red-300"}):null;return(0,s.jsxs)("div",{className:"h-full flex flex-col gap-4",children:[(0,s.jsxs)(n.Zp,{className:"w-full",children:[(0,s.jsx)(n.aR,{children:(0,s.jsx)(n.ZB,{children:"Tokens"})}),(0,s.jsx)(n.Wu,{className:"overflow-y-auto",children:0===t.length?(0,s.jsx)("p",{className:"text-sm text-muted-foreground text-center",children:"No tokens on the map."}):(0,s.jsx)("ul",{className:"space-y-2",children:t.map(e=>(0,s.jsxs)("li",{className:"flex flex-col p-2 rounded-md hover:bg-accent/50 transition-colors gap-2 text-sm",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2 flex-1 min-w-0",children:[(0,s.jsxs)(Y,{children:[(0,s.jsx)(q,{asChild:!0,disabled:"Light"===e.type||"Portal"===e.type,children:(0,s.jsx)("div",{className:(0,x.cn)("w-8 h-8 rounded-full flex items-center justify-center ring-2 ring-white/50 shadow-lg shrink-0 bg-cover bg-center","Light"!==e.type&&"Portal"!==e.type&&"cursor-pointer"),style:{backgroundColor:e.color,backgroundImage:e.iconUrl?"url(".concat(e.iconUrl,")"):"none"},children:!e.iconUrl&&A(e)})}),(0,s.jsx)(G,{className:"w-auto p-2",children:(0,s.jsxs)("div",{className:"flex items-center gap-4",children:[(0,s.jsxs)("div",{className:"flex flex-col gap-2 items-center",children:[(0,s.jsx)(ep,{children:"Color"}),(0,s.jsx)("input",{type:"color",value:e.color,onChange:t=>u(e.id,t.target.value),className:"w-10 h-10 border-none cursor-pointer",title:"Change token color"})]}),(0,s.jsx)(g,{orientation:"vertical",className:"h-16"}),(0,s.jsxs)("div",{className:"flex flex-col gap-2 items-start",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("input",{type:"file",accept:"image/*",className:"hidden",id:"file-input-".concat(e.id),onChange:t=>z(e.id,t)}),(0,s.jsx)(r.$,{onClick:()=>{var t;return null==(t=document.getElementById("file-input-".concat(e.id)))?void 0:t.click()},children:"Upload Icon"})]}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(ep,{children:"Size"}),(0,s.jsx)(H.p,{type:"number",min:1,max:20,value:e.size,onChange:t=>m(e.id,parseInt(t.target.value,10)||1),className:"h-8 w-20 text-center"})]})]})]})})]}),(0,s.jsx)(H.p,{className:"h-8 border-none bg-transparent focus-visible:ring-1 focus-visible:ring-ring truncate",value:e.name,onChange:t=>c(e.id,t.target.value),"aria-label":"Token name",disabled:"Light"===e.type||"Portal"===e.type})]}),(0,s.jsxs)("div",{className:"flex items-center shrink-0",children:["Light"!==e.type&&"Portal"!==e.type&&(0,s.jsx)(r.$,{variant:"ghost",size:"icon",className:"h-8 w-8",onClick:()=>a(e.id,!e.visible),title:e.visible?"Hide Token":"Show Token",children:e.visible?(0,s.jsx)(o.A,{className:"h-4 w-4"}):(0,s.jsx)(d.A,{className:"h-4 w-4"})}),(0,s.jsx)(r.$,{variant:"ghost",size:"icon",className:"text-destructive hover:text-destructive h-8 w-8",onClick:()=>i(e.id),title:"Delete Token",disabled:"Light"===e.type,children:(0,s.jsx)(U.A,{className:"h-4 w-4"})})]})]}),("PC"===e.type||"Enemy"===e.type)&&(0,s.jsx)("div",{className:"pl-10 flex flex-col items-start gap-4",children:(0,s.jsxs)("div",{className:"flex flex-col gap-2 w-full",children:[(0,s.jsxs)(r.$,{variant:"ghost",className:"h-8 px-2 justify-start",onClick:()=>p(e.id),children:[(0,s.jsx)(V.A,{className:(0,x.cn)("h-4 w-4 mr-2",e.torch.enabled?"text-orange-500":"text-muted-foreground")}),(0,s.jsx)("span",{className:(0,x.cn)(e.torch.enabled?"text-primary":"text-muted-foreground"),children:"Torch"})]}),e.torch.enabled&&(0,s.jsxs)("div",{className:"flex items-center gap-2 w-full",children:[(0,s.jsx)(r.$,{size:"icon",variant:"outline",className:"h-8 w-8 shrink-0",onClick:()=>b(e.id,Math.max(1,e.torch.radius-1)),children:(0,s.jsx)($.A,{})}),(0,s.jsx)(H.p,{type:"number",min:1,max:999,value:e.torch.radius,onChange:t=>b(e.id,parseInt(t.target.value,10)||1),className:"h-8 w-full text-center"}),(0,s.jsx)(r.$,{size:"icon",variant:"outline",className:"h-8 w-8 shrink-0",onClick:()=>b(e.id,e.torch.radius+1),children:(0,s.jsx)(Z.A,{})})]})]})})]},e.id))})})]}),(0,s.jsx)("div",{className:"flex-1"}),(0,s.jsx)(n.Zp,{children:(0,s.jsxs)(n.Wu,{className:"p-2 space-y-2",children:[(0,s.jsx)("p",{className:"text-sm text-muted-foreground p-2",children:"Share this URL for the player screen."}),(0,s.jsxs)("div",{className:"flex items-center gap-2 p-2",children:[(0,s.jsx)(H.p,{readOnly:!0,value:w,className:"bg-muted border-none"}),(0,s.jsx)(r.$,{size:"icon",variant:"outline",onClick:()=>{navigator.clipboard&&(navigator.clipboard.writeText(w),N({title:"Player URL Copied!",description:"Share this link with your players."}))},children:(0,s.jsx)(B.A,{className:"h-4 w-4"})})]}),(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-2",children:[(0,s.jsxs)(r.$,{variant:"outline",onClick:v,children:[(0,s.jsx)(o.A,{className:"mr-2 h-4 w-4"})," Sync View"]}),(0,s.jsxs)(r.$,{variant:"outline",onClick:y,children:[(0,s.jsx)(W.A,{className:"mr-2 h-4 w-4"})," Match View"]})]}),(0,s.jsx)(g,{}),(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-2",children:[(0,s.jsx)(r.$,{variant:"outline",asChild:!0,children:(0,s.jsxs)(eu(),{href:"/",children:[(0,s.jsx)(J.A,{className:"mr-2 h-4 w-4"})," Home"]})}),(0,s.jsxs)(Q,{children:[(0,s.jsx)(ee,{asChild:!0,children:(0,s.jsx)(r.$,{variant:"destructive",children:"End Session"})}),(0,s.jsxs)(es,{children:[(0,s.jsxs)(el,{children:[(0,s.jsx)(en,{children:"Are you sure you want to end the session?"}),(0,s.jsx)(ei,{children:"This action cannot be undone. Your map will be saved, but the session will end."})]}),(0,s.jsxs)(er,{children:[(0,s.jsx)(ed,{children:"Cancel"}),(0,s.jsx)(eo,{asChild:!0,children:(0,s.jsx)(eu(),{href:"/",children:"End Session"})})]})]})]})]})]})})]})}ep.displayName=eh.b.displayName;var eg=a(7822),eb=a(8073);let ej=l.forwardRef((e,t)=>{let{className:a,...l}=e;return(0,s.jsxs)(eb.bL,{ref:t,className:(0,x.cn)("relative flex w-full touch-none select-none items-center",a),...l,children:[(0,s.jsx)(eb.CC,{className:"relative h-2 w-full grow overflow-hidden rounded-full bg-secondary",children:(0,s.jsx)(eb.Q6,{className:"absolute h-full bg-primary"})}),(0,s.jsx)(eb.zi,{className:"block h-5 w-5 rounded-full border-2 border-primary bg-background ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50"})]})});ej.displayName=eb.bL.displayName;var ev=a(9864),ey=a(124);let eN=(0,em.F)("inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors hover:bg-muted hover:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=on]:bg-accent data-[state=on]:text-accent-foreground",{variants:{variant:{default:"bg-transparent",outline:"border border-input bg-transparent hover:bg-accent hover:text-accent-foreground"},size:{default:"h-10 px-3",sm:"h-9 px-2.5",lg:"h-11 px-5"}},defaultVariants:{variant:"default",size:"default"}});l.forwardRef((e,t)=>{let{className:a,variant:l,size:r,...n}=e;return(0,s.jsx)(ey.b,{ref:t,className:(0,x.cn)(eN({variant:l,size:r,className:a})),...n})}).displayName=ey.b.displayName;let ew=l.createContext({size:"default",variant:"default"}),ek=l.forwardRef((e,t)=>{let{className:a,variant:l,size:r,children:n,...i}=e;return(0,s.jsx)(ev.bL,{ref:t,className:(0,x.cn)("flex items-center justify-center gap-1",a),...i,children:(0,s.jsx)(ew.Provider,{value:{variant:l,size:r},children:n})})});ek.displayName=ev.bL.displayName;let eC=l.forwardRef((e,t)=>{let{className:a,children:r,variant:n,size:i,...o}=e,d=l.useContext(ew);return(0,s.jsx)(ev.q7,{ref:t,className:(0,x.cn)(eN({variant:d.variant||n,size:d.size||i}),a),...o,children:r})});eC.displayName=ev.q7.displayName;var eS=a(4884);let ez=l.forwardRef((e,t)=>{let{className:a,...l}=e;return(0,s.jsx)(eS.bL,{className:(0,x.cn)("peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input",a),...l,ref:t,children:(0,s.jsx)(eS.zi,{className:(0,x.cn)("pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0")})})});ez.displayName=eS.bL.displayName;var eA=a(3221),eT=a.n(eA);function eE(e){return[[e.points.map(e=>[e.x,e.y])]]}async function eP(e){if(0===e.length)return null;if(1===e.length)return{points:e[0].points,color:e[0].color,width:e[0].width,blocksLight:e[0].blocksLight,isPortal:!1};try{let t=e.map(eE),a=eT().union(...t);if(0===a.length||0===a[0].length)return console.error("Polygon clipping returned an empty result."),null;let s=a[0][0].map(e=>({x:e[0],y:e[1]})),l=e[0];return{points:s,color:l.color,width:l.width,blocksLight:e.some(e=>e.blocksLight),isPortal:!1}}catch(e){return console.error("Failed to merge shapes:",e),null}}let eI=["#000000","#ef4444","#f97316","#eab308","#84cc16","#22c55e","#14b8a6","#06b6d4","#3b82f6","#8b5cf6","#d946ef","#f43f5e"];function eR(e){let{sessionId:t}=e,[a,p]=(0,l.useState)([]),[g,b]=(0,l.useState)(-1),[j,v]=(0,l.useState)(!0),[y,N]=(0,l.useState)(!0),[w,k]=(0,l.useState)(!1),[C,S]=(0,l.useState)("select"),[z,A]=(0,l.useState)("line"),[T,E]=(0,l.useState)("wall"),[P,I]=(0,l.useState)("#000000"),[R,L]=(0,l.useState)(5),[D,O]=(0,l.useState)(20),M=a[g]||{paths:[],tokens:[],backgroundImage:null,cellSize:40},{paths:F,tokens:U,backgroundImage:V,cellSize:$}=M,[Z,B]=(0,l.useState)(1),[W,J]=(0,l.useState)({x:0,y:0}),[H,K]=(0,l.useState)(1),[X,ee]=(0,l.useState)({x:0,y:0}),[et,ea]=(0,l.useState)(!0),{toast:ec}=(0,f.dj)(),eu="tabletop-alchemist-session-".concat(t),[eh,em]=(0,l.useState)(!1),ef=(0,l.useRef)(null),eb=(0,l.useCallback)(e=>{p(t=>{let a=t.slice(0,g+1),s=a[a.length-1]||{paths:[],tokens:[],backgroundImage:null,cellSize:40};return a.push({...s,...e}),a}),b(e=>e+1)},[g]);(0,l.useEffect)(()=>{try{let e=localStorage.getItem(eu);if(e){let t=JSON.parse(e),a=(t.paths||[]).map(e=>({...e,id:e.id||"path-".concat(Math.random()),isPortal:e.isPortal||!1})),s=(t.tokens||[]).map(e=>({...e,type:e.type||(e.id.startsWith("pc-")?"PC":"Enemy"),size:e.size||1,torch:e.torch||{enabled:!1,radius:5}})),l=t.backgroundImage||null,r=t.cellSize||40;p([{paths:a,tokens:s,backgroundImage:l,cellSize:r}]),b(0),t.zoom&&B(t.zoom),t.pan&&J(t.pan),t.playerZoom&&K(t.playerZoom),t.playerPan&&ee(t.playerPan)}else p([{paths:[],tokens:[],backgroundImage:null,cellSize:40}]),b(0)}catch(e){console.error("Failed to load game state from localStorage",e),p([{paths:[],tokens:[],backgroundImage:null,cellSize:40}]),b(0)}},[t]),(0,l.useEffect)(()=>{if(g<0)return;let e={...M,zoom:Z,pan:W,playerZoom:H,playerPan:X},t=setTimeout(()=>{try{localStorage.setItem(eu,JSON.stringify(e))}catch(e){console.error("Failed to save game state to localStorage",e),ec({title:"Error",description:"Could not save game state. Your browser might be in private mode or storage is full.",variant:"destructive"})}},500);return()=>clearTimeout(t)},[M,Z,W,H,X,g,eu,ec]);let ev=(0,l.useCallback)(()=>{g>0&&b(e=>e-1)},[g]),ey=(0,l.useCallback)(()=>{g<a.length-1&&b(e=>e+1)},[a,g]);(0,l.useEffect)(()=>{let e=e=>{(e.ctrlKey||e.metaKey)&&("z"===e.key?(e.preventDefault(),ev()):("y"===e.key||e.shiftKey&&"z"===e.key)&&(e.preventDefault(),ey()))};return window.addEventListener("keydown",e),()=>{window.removeEventListener("keydown",e)}},[ev,ey]);let eN=(0,l.useCallback)(async e=>{let t="portal"===C,a={...e,id:"path-".concat(Date.now()),isPortal:t,blocksLight:t||"wall"===T},s=[...U];if(t&&a.points.length>0){let{x:e,y:t}=a.points.reduce((e,t)=>({x:e.x+t.x,y:e.y+t.y}),{x:0,y:0}),l=e/a.points.length,r=t/a.points.length,n={id:"portal-token-".concat(Date.now()),name:"Portal ".concat(U.filter(e=>"Portal"===e.type).length+1),x:l,y:r,type:"Portal",visible:!1,color:"#ff00ff",size:1,torch:{enabled:!1,radius:0},controls:a.id};s.push(n)}if(w&&("rectangle"===C||"circle"===C||"draw"===C)){let e=F.filter(e=>e.blocksLight===a.blocksLight&&function(e,t){try{let a=eE(e),s=eE(t);return eT().intersection(a,s).length>0}catch(e){return console.error("Failed to check path intersection:",e),!1}}(e,a));if(e.length>0){let t=[...e,a],l=await eP(t);if(l){let t={...l,id:"path-".concat(Date.now(),"-merged")},a=new Set(e.map(e=>e.id));eb({paths:[...F.filter(e=>!a.has(e.id)),t],tokens:s})}else eb({paths:[...F,a],tokens:s})}else eb({paths:[...F,a],tokens:s})}else eb({paths:[...F,a],tokens:s})},[F,U,eb,T,w,C]),ew=(0,l.useCallback)(e=>{let t=(e,t)=>(e.x-t.x)**2+(e.y-t.y)**2,a=(e,a,s)=>{let l=t(a,s);if(0===l)return t(e,a);let r=((e.x-a.x)*(s.x-a.x)+(e.y-a.y)*(s.y-a.y))/l;return r=Math.max(0,Math.min(1,r)),t(e,{x:a.x+r*(s.x-a.x),y:a.y+r*(s.y-a.y)})},s=F.find(t=>{for(let s=0;s<t.points.length-1;s++)if(400>a(e,t.points[s],t.points[s+1]))return!0;return!1});s&&eb({paths:F.filter(e=>e.id!==s.id)})},[F,eb]),eS=(0,l.useCallback)(e=>{eb({paths:e})},[eb]),eA=(0,l.useCallback)((e,t)=>{eb({tokens:U.map(a=>a.id===e?{...a,...t}:a)})},[U,eb]),eR=e=>{let t=U.find(t=>t.id===e);t&&eA(e,{torch:{...t.torch,enabled:!t.torch.enabled}})},eL=(0,l.useCallback)(e=>{let t=a.slice(0,g+1),s=t[t.length-1];if(!s)return;let l=s.tokens.find(t=>t.id===e);if(!l||!l.controls)return;let r=s.paths.map(e=>e.id===l.controls?{...e,blocksLight:!e.blocksLight}:e),n={...s,paths:r};t.push(n),p(t),b(t.length-1)},[a,g]),eD=e=>B(t=>Math.max(.1,Math.min(5,t+e))),eO="draw"===C||"rectangle"===C||"circle"===C;return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(Q,{open:eh,onOpenChange:em,children:(0,s.jsxs)(es,{children:[(0,s.jsxs)(el,{children:[(0,s.jsx)(en,{children:"Import New Map?"}),(0,s.jsx)(ei,{children:"Importing a new map will clear all existing walls, drawings, and tokens from the current map. This action cannot be undone."})]}),(0,s.jsxs)(er,{children:[(0,s.jsx)(ed,{onClick:()=>ef.current=null,children:"Cancel"}),(0,s.jsx)(eo,{onClick:()=>{if(!ef.current)return;let e=ef.current,t=new FileReader;t.onload=t=>{try{var a;let s=null==(a=t.target)?void 0:a.result,l=JSON.parse(s),r=l.resolution.pixels_per_grid,n="data:image/webp;base64,".concat(l.image),i=(l.line_of_sight||[]).map((e,t)=>({id:"wall-".concat(Date.now(),"-").concat(t),points:e.map(e=>({x:e.x*r,y:e.y*r})),color:"#000000",width:5,blocksLight:!0,isPortal:!1})),o=[],d=[];(l.portals||[]).forEach((e,t)=>{let a="portal-wall-".concat(Date.now(),"-").concat(t);o.push({id:a,points:e.bounds.map(e=>({x:e.x*r,y:e.y*r})),color:"#ff0000",width:5,blocksLight:!0,isPortal:!0}),d.push({id:"portal-token-".concat(Date.now(),"-").concat(t),name:"Portal ".concat(t+1),x:e.position.x*r,y:e.position.y*r,type:"Portal",visible:!1,color:"#ff0000",size:1,torch:{enabled:!1,radius:0},controls:a})});let c=(l.lights||[]).map((e,t)=>({id:"light-".concat(Date.now(),"-").concat(t),name:"Light ".concat(t+1),x:e.position.x*r,y:e.position.y*r,type:"Light",visible:!1,color:"#fBBF24",size:1,torch:{enabled:!0,radius:e.range/2}})),u=[...i,...o],h=[...c,...d];J({x:0,y:0}),B(1),eb({paths:u,tokens:h,backgroundImage:n,cellSize:r}),ec({title:"Map Imported!",description:"".concat(e.name," was successfully imported.")})}catch(e){console.error("Failed to parse dd2vtt file",e),ec({title:"Import Failed",description:"The selected file could not be parsed. Please ensure it's a valid .dd2vtt file.",variant:"destructive"})}finally{ef.current=null,em(!1)}},t.readAsText(e)},children:"Import"})]})]})}),(0,s.jsxs)("div",{className:"flex h-dvh w-screen bg-background text-foreground",children:[(0,s.jsx)(_,{selectedTool:C,onToolSelect:S,onImport:e=>{ef.current=e,em(!0)},undo:ev,redo:ey,resetView:()=>{B(1),J({x:0,y:0})},zoomIn:()=>eD(.1),zoomOut:()=>eD(-.1)}),(0,s.jsxs)("main",{className:"flex-1 flex flex-col relative bg-muted/30",children:[(0,s.jsxs)("div",{className:"absolute top-2 left-2 z-10 p-2 rounded-lg bg-card border border-border flex items-center gap-2",children:[(0,s.jsx)(r.$,{variant:j?"default":"outline",onClick:()=>v(!j),size:"icon",className:"w-8 h-8",children:(0,s.jsx)(i.A,{})}),(0,s.jsx)(r.$,{variant:et?"default":"outline",onClick:()=>ea(!et),size:"icon",className:"w-8 h-8",children:et?(0,s.jsx)(o.A,{}):(0,s.jsx)(d.A,{})})]}),eO&&(0,s.jsx)(n.Zp,{className:"absolute top-2 left-24 z-10 p-2 rounded-lg bg-card border border-border flex items-center gap-4",children:(0,s.jsxs)(n.Wu,{className:"p-2 flex items-center gap-4",children:[(0,s.jsxs)(ek,{type:"single",value:T,onValueChange:e=>e&&E(e),children:[(0,s.jsxs)(eC,{value:"wall","aria-label":"Draw as walls",children:[(0,s.jsx)(c.A,{className:"h-4 w-4"}),(0,s.jsx)("span",{className:"ml-2",children:"Wall"})]}),(0,s.jsxs)(eC,{value:"detail","aria-label":"Draw as details",children:[(0,s.jsx)(u.A,{className:"h-4 w-4"}),(0,s.jsx)("span",{className:"ml-2",children:"Detail"})]})]}),(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,s.jsx)(ez,{id:"snap-to-grid",checked:y,onCheckedChange:N}),(0,s.jsx)(ep,{htmlFor:"snap-to-grid",children:"Snap"})]}),(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,s.jsx)(ez,{id:"smart-mode",checked:w,onCheckedChange:k}),(0,s.jsx)(ep,{htmlFor:"smart-mode",children:"Smart"})]}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(ep,{className:"text-sm font-medium",children:"Size"}),(0,s.jsx)(ej,{id:"brush-size-slider",min:2,max:50,step:1,value:[R],onValueChange:e=>L(e[0]),className:"w-32"}),(0,s.jsx)("span",{className:"text-sm font-bold w-8 text-center",children:R})]}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(ep,{className:"text-sm font-medium",children:"Color"}),(0,s.jsxs)(Y,{children:[(0,s.jsx)(q,{asChild:!0,children:(0,s.jsx)(r.$,{style:{backgroundColor:P},className:"w-8 h-8 rounded-md border-2 border-border"})}),(0,s.jsx)(G,{className:"w-auto p-0 border-none",children:(0,s.jsx)("div",{className:"grid grid-cols-6 gap-1 p-1 bg-card rounded-md",children:eI.map(e=>(0,s.jsx)("button",{type:"button",className:(0,x.cn)("w-8 h-8 rounded-md border-2 transition-all",P===e?"border-primary":"border-transparent hover:border-muted-foreground/50"),style:{backgroundColor:e},onClick:()=>I(e),"aria-label":"Select color ".concat(e)},e))})})]})]})]})}),"erase"===C&&(0,s.jsx)(n.Zp,{className:"absolute top-2 left-24 z-10 p-2 rounded-lg bg-card border border-border flex items-center gap-4",children:(0,s.jsxs)(n.Wu,{className:"p-2 flex items-center gap-4",children:[(0,s.jsxs)(ek,{type:"single",value:z,onValueChange:e=>e&&A(e),children:[(0,s.jsx)(eC,{value:"line","aria-label":"Erase whole line",children:(0,s.jsx)(h.A,{className:"h-4 w-4"})}),(0,s.jsx)(eC,{value:"brush","aria-label":"Erase with brush",children:(0,s.jsx)(m.A,{className:"h-4 w-4"})})]}),"brush"===z&&(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(ep,{className:"text-sm font-medium",children:"Eraser Size"}),(0,s.jsx)(ej,{id:"eraser-size-slider",min:5,max:100,step:1,value:[D],onValueChange:e=>O(e[0]),className:"w-32"}),(0,s.jsx)("span",{className:"text-sm font-bold w-8 text-center",children:D})]})]})}),(0,s.jsx)("div",{className:"flex-1 relative overflow-hidden",children:(0,s.jsx)(eg.v,{showGrid:j,snapToGrid:y,tokens:U,paths:F,backgroundImage:V,cellSize:$,onMapClick:(e,t)=>{let a=null;"add-pc"===C&&(a={id:"pc-".concat(Date.now()),name:"PC ".concat(U.filter(e=>"PC"===e.type).length+1),x:e,y:t,type:"PC",visible:!0,color:"#3b82f6",size:1,torch:{enabled:!1,radius:5}}),"add-enemy"===C&&(a={id:"enemy-".concat(Date.now()),name:"Enemy ".concat(U.filter(e=>"Enemy"===e.type).length+1),x:e,y:t,type:"Enemy",visible:!1,color:"#ef4444",size:1,torch:{enabled:!1,radius:5}}),a&&eb({tokens:[...U,a]})},onEraseLine:ew,onEraseBrush:eS,onNewPath:eN,onTokenTorchToggle:eR,onPortalToggle:eL,selectedTool:C,eraseMode:z,drawMode:T,onTokenMove:(e,t,a)=>eA(e,{x:t,y:a}),brushColor:P,brushSize:R,eraseBrushSize:D,zoom:Z,pan:W,onZoomChange:B,onPanChange:J,showFogOfWar:et})})]}),(0,s.jsx)("aside",{className:"w-80 h-full flex flex-col p-4 gap-4 border-l border-border bg-card z-20",children:(0,s.jsx)(ex,{tokens:U.filter(e=>"Light"!==e.type),onVisibilityChange:(e,t)=>eA(e,{visible:t}),onTokenDelete:e=>{let t=U.find(t=>t.id===e),a=F;t&&"Portal"===t.type&&t.controls&&(a=F.filter(e=>e.id!==t.controls)),eb({tokens:U.filter(t=>t.id!==e),paths:a})},onTokenNameChange:(e,t)=>eA(e,{name:t}),onTokenColorChange:(e,t)=>eA(e,{color:t}),onTokenIconChange:(e,t)=>eA(e,{iconUrl:t}),onTokenSizeChange:(e,t)=>eA(e,{size:t}),onTokenTorchToggle:eR,onTokenTorchRadiusChange:(e,t)=>{let a=U.find(t=>t.id===e);a&&eA(e,{torch:{...a.torch,radius:t}})},sessionId:t,syncPlayerView:()=>{ee(W),K(Z),ec({title:"Player View Synced!",description:"The player's view now matches yours."})},matchPlayerView:()=>{J(X),B(H)}})})]})]})}function eL(){let[e,t]=(0,l.useState)(null);return((0,l.useEffect)(()=>{let e=window.location.hash.substring(1);e?t(e):console.error("No session ID found in URL hash.")},[]),e)?(0,s.jsx)(eR,{sessionId:e}):(0,s.jsx)("div",{children:"Loading session..."})}},2523:(e,t,a)=>{"use strict";a.d(t,{p:()=>n});var s=a(5155),l=a(2115),r=a(9434);let n=l.forwardRef((e,t)=>{let{className:a,type:l,...n}=e;return(0,s.jsx)("input",{type:l,className:(0,r.cn)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",a),ref:t,...n})});n.displayName="Input"},4933:(e,t,a)=>{Promise.resolve().then(a.bind(a,1092))},6695:(e,t,a)=>{"use strict";a.d(t,{BT:()=>d,Wu:()=>c,ZB:()=>o,Zp:()=>n,aR:()=>i});var s=a(5155),l=a(2115),r=a(9434);let n=l.forwardRef((e,t)=>{let{className:a,...l}=e;return(0,s.jsx)("div",{ref:t,className:(0,r.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",a),...l})});n.displayName="Card";let i=l.forwardRef((e,t)=>{let{className:a,...l}=e;return(0,s.jsx)("div",{ref:t,className:(0,r.cn)("flex flex-col space-y-1.5 p-6",a),...l})});i.displayName="CardHeader";let o=l.forwardRef((e,t)=>{let{className:a,...l}=e;return(0,s.jsx)("div",{ref:t,className:(0,r.cn)("text-2xl font-semibold leading-none tracking-tight",a),...l})});o.displayName="CardTitle";let d=l.forwardRef((e,t)=>{let{className:a,...l}=e;return(0,s.jsx)("div",{ref:t,className:(0,r.cn)("text-sm text-muted-foreground",a),...l})});d.displayName="CardDescription";let c=l.forwardRef((e,t)=>{let{className:a,...l}=e;return(0,s.jsx)("div",{ref:t,className:(0,r.cn)("p-6 pt-0",a),...l})});c.displayName="CardContent",l.forwardRef((e,t)=>{let{className:a,...l}=e;return(0,s.jsx)("div",{ref:t,className:(0,r.cn)("flex items-center p-6 pt-0",a),...l})}).displayName="CardFooter"},7481:(e,t,a)=>{"use strict";a.d(t,{dj:()=>h});var s=a(2115);let l=0,r=new Map,n=e=>{if(r.has(e))return;let t=setTimeout(()=>{r.delete(e),c({type:"REMOVE_TOAST",toastId:e})},1e6);r.set(e,t)},i=(e,t)=>{switch(t.type){case"ADD_TOAST":return{...e,toasts:[t.toast,...e.toasts].slice(0,1)};case"UPDATE_TOAST":return{...e,toasts:e.toasts.map(e=>e.id===t.toast.id?{...e,...t.toast}:e)};case"DISMISS_TOAST":{let{toastId:a}=t;return a?n(a):e.toasts.forEach(e=>{n(e.id)}),{...e,toasts:e.toasts.map(e=>e.id===a||void 0===a?{...e,open:!1}:e)}}case"REMOVE_TOAST":if(void 0===t.toastId)return{...e,toasts:[]};return{...e,toasts:e.toasts.filter(e=>e.id!==t.toastId)}}},o=[],d={toasts:[]};function c(e){d=i(d,e),o.forEach(e=>{e(d)})}function u(e){let{...t}=e,a=(l=(l+1)%Number.MAX_SAFE_INTEGER).toString(),s=()=>c({type:"DISMISS_TOAST",toastId:a});return c({type:"ADD_TOAST",toast:{...t,id:a,open:!0,onOpenChange:e=>{e||s()}}}),{id:a,dismiss:s,update:e=>c({type:"UPDATE_TOAST",toast:{...e,id:a}})}}function h(){let[e,t]=s.useState(d);return s.useEffect(()=>(o.push(t),()=>{let e=o.indexOf(t);e>-1&&o.splice(e,1)}),[e]),{...e,toast:u,dismiss:e=>c({type:"DISMISS_TOAST",toastId:e})}}}},e=>{var t=t=>e(e.s=t);e.O(0,[769,487,897,822,441,684,358],()=>t(4933)),_N_E=e.O()}]);